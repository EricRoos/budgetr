<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><%= link_to 'Projects', projects_path %></li>
    <li class="breadcrumb-item active" aria-current="page"><%= @project.name %></li>
  </ol>
</nav>
<div class="jumbotron">
  <h1>
    <%= @project.name %>
  </h1>

  <% callout_boxes = [] %>
  <% callout_boxes << { title: "Total Spent", content: @project.item_groups.map(&:total_spent).inject(:+) } %>
  <% callout_boxes << { title: "Total Allocated", content: @project.item_groups.map(&:total_allocated).inject(:+) } %>
  <% callout_boxes << { title: "Budget", content: humanized_money_with_symbol(@project.budget) } %>
  <div class="row">
    <% callout_boxes.each do |callout_box| %>
      <div class="col-lg-3">
        <div class="card widget-flat">
          <div class="card-body">
            <div class="float-right">
                <i class="mdi mdi-currency-usd widget-icon"></i>
            </div>
            <h5 class="text-muted font-weight-normal mt-0" title="Budget"><%= callout_box[:title] %></h5>
            <h3 class="mt-3 mb-3"><%= callout_box[:content] %></h3>
            <p class="mb-0 text-muted">
              <%= callout_box[:small] %>
              &nbsp;
            </p>
          </div> <!-- end card-body-->
        </div> <!-- end card-->
      </div> <!-- end col-->
    <% end %>
  </div> <!-- end row -->
  <%= link_to 'Update', edit_project_path(@project) %>
</div>

<div class="card">
  <div class="card-body" style="position: relative;">
    <div class="dropdown float-right">
        <a href="#" class="dropdown-toggle arrow-none card-drop" data-toggle="dropdown" aria-expanded="false">
            <i class="mdi mdi-dots-vertical"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right">
          <a class='dropdown-item' href='#' data-toggle="modal" data-target="#itemGroupModal">
            Add Item Group 
          </a>
        </div>
    </div>
    <div class="modal fade" id="itemGroupModal" tabindex="-1" role="dialog" aria-labelledby="itemGroupModalLabel" aria-hidden="true">
      <%= render partial: 'item_groups/modal_form', locals: { item_group: ItemGroup.new(project: @project) } %>
    </div>
    <% item_group_header_text = 'Rooms' %>
    <h4 class="header-title mb-3"><%= item_group_header_text %></h4>
    <table>
      <thead>
      </thead>
      <tbody>
        <% @project.item_groups.order(name: :asc).each do |item_group| %>
          <% total_spent = humanized_money_with_symbol(item_group.items.map(&:purchase_price).select{ |s| s.present? }.sum || 0) %>
          <% total_spent_presented = "(#{total_spent} / #{humanized_money_with_symbol(item_group.budget)})" %>
          <tr>
            <td><%=link_to "#{item_group.name} #{total_spent_presented}", [@project, item_group] %></td>
            <td><%= link_to "Delete", [@project, item_group], method: :delete, class: 'btn btn-danger', data: { confirm: 'Are you sure?' } %> </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
